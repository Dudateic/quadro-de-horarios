<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f2f5f1">
  <title>Quadro de Hor√°rios</title>
  
  <link rel="manifest" href="manifest.json">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  
  <style>
:root {
  --cor-fundo: #f2f5f1;
  --cor-surface: #ffffff;
  --cor-texto-pri: #3a4a3b;
  --cor-texto-sec: #758576;
  --cor-destaque: #7c9a6f;
  --cor-destaque-hover: #5e7a53;
  --cor-perigo: #d66d6d;
  --cor-input: #f7f9f7;
  --sombra: 0 8px 30px rgba(0,0,0,0.04);
  --borda: rgba(0,0,0,0.05);
  --raio-grande: 24px;
  --raio-medio: 16px;
}

body.modo-escuro {
  --cor-fundo: #121212;
  --cor-surface: #1e1e1e;
  --cor-texto-pri: #e0e0e0;
  --cor-texto-sec: #a0a0a0;
  --cor-destaque: #8fb87d; 
  --cor-destaque-hover: #a3cc91;
  --cor-input: #2c2c2c;
  --sombra: 0 8px 30px rgba(0,0,0,0.3);
  --borda: rgba(255,255,255,0.1);
}

* { box-sizing: border-box; font-family: 'Inter', sans-serif; outline: none; -webkit-tap-highlight-color: transparent; }

body {
  margin: 0; padding: 40px 20px;
  background: var(--cor-fundo); color: var(--cor-texto-pri);
  min-height: 100vh; display: flex; flex-direction: column; align-items: center;
  transition: background 0.3s ease, color 0.3s ease;
}

header { width: 100%; max-width: 1000px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
h1 { font-weight: 700; font-size: 1.8rem; margin: 0; letter-spacing: -0.5px; }

.btn-icone {
  width: 44px; height: 44px; border-radius: 50%; border: none;
  background: var(--cor-surface); color: var(--cor-texto-pri);
  box-shadow: var(--sombra); cursor: pointer;
  display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
  transition: transform 0.2s;
}
.btn-icone:hover { transform: scale(1.1); }

.container-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 25px; max-width: 1000px; width: 100%; margin-bottom: 30px;
}

.cartao {
  background: var(--cor-surface); padding: 28px; border-radius: var(--raio-grande);
  box-shadow: var(--sombra); border: 1px solid var(--borda);
}

.grupo-input label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--cor-texto-sec); margin-bottom: 8px; }
input, select {
  width: 100%; padding: 14px; font-size: 0.95rem; background: var(--cor-input);
  border: 1px solid transparent; border-radius: var(--raio-medio); color: var(--cor-texto-pri); margin-bottom: 16px;
}
input:focus, select:focus { border-color: var(--cor-destaque); background: var(--cor-surface); }

.seletor-cor {
  display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--cor-input);
  border-radius: var(--raio-medio); cursor: pointer; margin-bottom: 16px;
}
.bolha-cor { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--cor-surface); }

.btn-primario {
  width: 100%; padding: 16px; border: none; border-radius: 50px; font-weight: 600;
  background: var(--cor-destaque); color: #fff; cursor: pointer;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: 0.2s; font-size: 1rem;
}
.btn-primario:hover { transform: translateY(-2px); background: var(--cor-destaque-hover); }

.container-quadro {
  max-width: 1100px; width: 100%; background: var(--cor-surface);
  padding: 30px; border-radius: var(--raio-grande); box-shadow: var(--sombra);
  overflow: hidden; margin-bottom: 30px; border: 1px solid var(--borda);
}
.scroll-tabela { overflow-x: auto; padding-bottom: 10px; }
table { width: 100%; min-width: 700px; border-collapse: separate; border-spacing: 0; }
th { padding: 15px; color: var(--cor-texto-sec); font-size: 0.8rem; text-transform: uppercase; border-bottom: 1px solid var(--borda); }
td { padding: 6px; border-bottom: 1px dashed var(--borda); height: 1px; vertical-align: middle; }
td:first-child { width: 90px; text-align: center; font-weight: 600; color: var(--cor-destaque); border-right: 1px solid var(--borda); }

.bloco-aula {
  height: 90%; border-radius: 12px; color: #fff; padding: 8px; font-size: 0.85rem;
  display: flex; flex-direction: column; justify-content: center; text-align: center;
  cursor: pointer; transition: 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-weight: 600;
}
.bloco-aula:hover { transform: scale(1.03); z-index: 5; }

.painel-ferramentas {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;
  width: 100%; max-width: 1000px; margin-top: 10px;
}
.btn-ferramenta {
  background: var(--cor-surface); padding: 15px; border-radius: var(--raio-medio);
  border: 1px solid var(--borda); color: var(--cor-texto-pri); cursor: pointer;
  font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 8px;
  box-shadow: var(--sombra); transition: 0.2s;
}
.btn-ferramenta:hover { background: var(--cor-input); transform: translateY(-2px); color: var(--cor-destaque); }
.icone-btn { font-size: 1.5rem; }

.modal-fundo {
  position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5);
  display: none; align-items: center; justify-content: center; z-index: 100; backdrop-filter: blur(4px);
}
.modal-conteudo { background: var(--cor-surface); padding: 30px; border-radius: 24px; width: 90%; max-width: 380px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
.modal-titulo { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; }
.btn-fechar { background: transparent; border: 1px solid var(--borda); color: var(--cor-texto-sec); padding: 10px 20px; border-radius: 30px; cursor: pointer; margin-right: 10px;}
.btn-excluir { background: var(--cor-perigo); color: white; border: none; padding: 10px 20px; border-radius: 30px; cursor: pointer; }

.notificacao {
  position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
  background: var(--cor-texto-pri); color: var(--cor-surface); padding: 12px 24px;
  border-radius: 50px; font-weight: 500; transition: 0.4s; opacity: 0; z-index: 200;
}
.notificacao.visivel { transform: translateX(-50%) translateY(0); opacity: 1; }

@media(max-width: 768px) { header { flex-direction: column; gap: 15px; } }
  </style>
</head>
<body>

  <header>
    <h1>Quadro de Hor√°rios</h1>
    <button class="btn-icone" onclick="alternarTema()" title="Alternar Tema">üåó</button>
  </header>

  <div class="container-grid">
    <div class="cartao">
      <h2>Nova Mat√©ria</h2>
      <div class="grupo-input">
        <label>Nome da Mat√©ria</label>
        <input type="text" id="inputNomeMateria" placeholder="Ex: Algoritmos I">
      </div>
      <div class="seletor-cor" onclick="document.getElementById('inputCorMateria').click()">
        <div id="visualizacaoCor" class="bolha-cor" style="background:#7c9a6f"></div>
        <span style="font-size:0.9rem; color:var(--cor-texto-sec)">Toque para escolher a cor</span>
        <input type="color" id="inputCorMateria" value="#7c9a6f" style="opacity:0; width:0; height:0;">
      </div>
      <button class="btn-primario" onclick="adicionarMateria()">+ Criar Mat√©ria</button>
    </div>

    <div class="cartao">
      <h2>Agendar Aula</h2>
      <div class="grupo-input">
        <label>Selecione a Mat√©ria</label>
        <select id="selectMateria"><option value="">Lista vazia...</option></select>
      </div>
      <div class="grupo-input">
        <label>Dia da Semana</label>
        <select id="selectDia">
          <option value="Segunda">Segunda-feira</option>
          <option value="Ter√ßa">Ter√ßa-feira</option>
          <option value="Quarta">Quarta-feira</option>
          <option value="Quinta">Quinta-feira</option>
          <option value="Sexta">Sexta-feira</option>
          <option value="S√°bado">S√°bado</option>
        </select>
      </div>
      <div style="display:flex; gap:15px">
        <div class="grupo-input" style="flex:1"><label>In√≠cio</label><input type="time" id="inputInicio"></div>
        <div class="grupo-input" style="flex:1"><label>Fim</label><input type="time" id="inputFim"></div>
      </div>
      <button class="btn-primario" onclick="agendarAula()">Agendar Hor√°rio</button>
    </div>
  </div>

  <div class="container-quadro" id="areaCaptura">
    <div class="scroll-tabela">
      <table id="tabelaPrincipal">
        <thead>
            <tr>
                <th>Hor√°rio</th>
                <th>Seg</th><th>Ter</th><th>Qua</th><th>Qui</th><th>Sex</th><th>S√°b</th>
            </tr>
        </thead>
        <tbody id="corpoTabela"></tbody>
      </table>
    </div>
    <div id="containerLegenda" style="display:flex; flex-wrap:wrap; gap:12px; margin-top:24px; justify-content:center;"></div>
  </div>

  <div class="painel-ferramentas">
    <button class="btn-ferramenta" onclick="exportarImagem()">
      <span class="text-btn"> Baixar Imagem
    </button>
    <button class="btn-ferramenta" onclick="exportarPDF()">
      <span class="text-btn">  Baixar PDF
    </button>
    <button class="btn-ferramenta" onclick="exportarJSON()">
      <span class="text-btn">  Backup
    </button>
    <button class="btn-ferramenta" onclick="document.getElementById('inputImportar').click()">
      <span class="text-btn"> Restaurar
    </button>
    <button class="btn-ferramenta" style="color:var(--cor-perigo); border-color:var(--cor-perigo)" onclick="limparTudo()">
      <span class="text-btn"> Limpar Tudo
    </button>
  </div>
  <input type="file" id="inputImportar" style="display:none" accept=".json" onchange="importarJSON(this)">

  <div class="modal-fundo" id="modalEdicao" onclick="if(event.target===this) fecharModal()">
    <div class="modal-conteudo">
      <div class="modal-titulo" id="tituloModal">Detalhes</div>
      <p id="descricaoModal" style="color:var(--cor-texto-sec); margin-bottom: 25px; line-height: 1.5;"></p>
      <input type="hidden" id="idAulaSelecionada">
      <div style="display: flex; justify-content: flex-end;">
        <button class="btn-fechar" onclick="fecharModal()">Fechar</button>
        <button class="btn-excluir" onclick="excluirAula()">Excluir Aula</button>
      </div>
    </div>
  </div>
  
  <div class="notificacao" id="toast">A√ß√£o realizada</div>

  <script>
    let dadosAgenda = { materias: {}, aulas: [] };
    const diasSemana = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado"];
    
    document.getElementById('inputCorMateria').addEventListener('input', (e) => 
      document.getElementById('visualizacaoCor').style.backgroundColor = e.target.value
    );

    function inicializar() {
      const salvo = localStorage.getItem('dadosViveri');
      if(salvo) { dadosAgenda = JSON.parse(salvo); atualizarInterface(); }
      
      const temaSalvo = localStorage.getItem('temaPreferido');
      if(temaSalvo === 'escuro') document.body.classList.add('modo-escuro');
    }
    
    window.onload = inicializar;

    function alternarTema() {
      document.body.classList.toggle('modo-escuro');
      localStorage.setItem('temaPreferido', document.body.classList.contains('modo-escuro') ? 'escuro' : 'claro');
    }

    function salvarDados() { 
      localStorage.setItem('dadosViveri', JSON.stringify(dadosAgenda)); 
      atualizarInterface(); 
    }

    function notificar(mensagem) { 
      const toast = document.getElementById('toast'); 
      toast.textContent = mensagem; 
      toast.classList.add('visivel'); 
      setTimeout(() => toast.classList.remove('visivel'), 2500); 
    }

    function adicionarMateria() {
      const nome = document.getElementById('inputNomeMateria').value.trim();
      const cor = document.getElementById('inputCorMateria').value;
      
      if(!nome) return notificar('Digite o nome da mat√©ria');
      
      dadosAgenda.materias[nome] = { cor };
      document.getElementById('inputNomeMateria').value = '';
      
      salvarDados(); 
      notificar('Mat√©ria criada com sucesso!');
    }

    function agendarAula() {
      const materia = document.getElementById('selectMateria').value;
      const dia = document.getElementById('selectDia').value;
      const inicio = document.getElementById('inputInicio').value;
      const fim = document.getElementById('inputFim').value;

      if(!materia || !inicio || !fim) return notificar('Preencha todos os campos');
      if(inicio >= fim) return notificar('Hor√°rio final deve ser maior que o inicial');

      dadosAgenda.aulas.push({ id: Date.now(), materia, dia, inicio, fim });
      salvarDados(); 
      notificar('Aula agendada!');
    }

    function atualizarInterface() {
      const select = document.getElementById('selectMateria');
      select.innerHTML = '<option value="">Selecione...</option>';
      Object.keys(dadosAgenda.materias).forEach(nome => {
          const opt = document.createElement('option');
          opt.value = nome;
          opt.textContent = nome;
          select.appendChild(opt);
      });

      const containerLegenda = document.getElementById('containerLegenda');
      containerLegenda.innerHTML = '';
      Object.entries(dadosAgenda.materias).forEach(([nome, props]) => {
        containerLegenda.innerHTML += `
            <div style="font-size:0.85rem; display:flex; align-items:center; gap:6px; background:var(--cor-input); padding:6px 12px; border-radius:20px;">
                <div style="width:12px;height:12px;border-radius:50%;background:${props.cor}"></div>
                ${nome}
            </div>`;
      });

      const corpoTabela = document.getElementById('corpoTabela');
      corpoTabela.innerHTML = '';
      
      let horarios = new Set(); 
      dadosAgenda.aulas.forEach(a => { horarios.add(a.inicio); horarios.add(a.fim); });
      let horariosOrdenados = Array.from(horarios).sort();

      if (horariosOrdenados.length === 0) {
          corpoTabela.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:30px; color:var(--cor-texto-sec)">O quadro est√° vazio. Adicione mat√©rias e aulas!</td></tr>';
          return;
      }

      for(let i=0; i<horariosOrdenados.length-1; i++) {
        const linha = document.createElement('tr');
        const horaInicio = horariosOrdenados[i];
        const horaFim = horariosOrdenados[i+1];
        
        linha.innerHTML = `<td>${horaInicio} - ${horaFim}</td>`;
        
        diasSemana.forEach(dia => {
          const celula = document.createElement('td');
          const aulaEncontrada = dadosAgenda.aulas.find(a => a.dia === dia && a.inicio < horaFim && a.fim > horaInicio);
          
          if(aulaEncontrada && aulaEncontrada.inicio === horaInicio) {
             let extensaoLinhas = 0;
             for(let j=i; j<horariosOrdenados.length-1; j++) {
               if(horariosOrdenados[j+1] <= aulaEncontrada.fim) extensaoLinhas++; else break;
             }
             celula.rowSpan = extensaoLinhas;
             celula.innerHTML = `
                <div class="bloco-aula" onclick="abrirModal(${aulaEncontrada.id})" style="background:${dadosAgenda.materias[aulaEncontrada.materia].cor}">
                    ${aulaEncontrada.materia}
                </div>`;
             linha.appendChild(celula);
          } else if (!aulaEncontrada) {
             linha.appendChild(celula);
          }
        });
        corpoTabela.appendChild(linha);
      }
    }

    function abrirModal(id) {
      const aula = dadosAgenda.aulas.find(x => x.id === id);
      document.getElementById('tituloModal').textContent = aula.materia;
      document.getElementById('descricaoModal').innerHTML = `<strong>Dia:</strong> ${aula.dia}<br><strong>Hor√°rio:</strong> ${aula.inicio} √†s ${aula.fim}`;
      document.getElementById('idAulaSelecionada').value = id;
      document.getElementById('modalEdicao').style.display = 'flex';
    }

    function fecharModal() { document.getElementById('modalEdicao').style.display = 'none'; }

    function excluirAula() {
      const id = Number(document.getElementById('idAulaSelecionada').value);
      dadosAgenda.aulas = dadosAgenda.aulas.filter(a => a.id !== id);
      fecharModal(); 
      salvarDados(); 
      notificar('Aula removida');
    }

    function limparTudo() { 
        if(confirm('Tem certeza que deseja apagar todo o planejamento?')) { 
            dadosAgenda={materias:{},aulas:[]}; 
            salvarDados(); 
            notificar('Tudo limpo!');
        } 
    }

    function exportarJSON() {
      const link = document.createElement('a');
      link.href = URL.createObjectURL(new Blob([JSON.stringify(dadosAgenda)],{type:'application/json'}));
      link.download = 'backup_plan.json'; 
      link.click();
    }

    function importarJSON(input) {
      const leitor = new FileReader();
      leitor.onload = (e) => { 
          try {
            dadosAgenda = JSON.parse(e.target.result); 
            salvarDados(); 
            notificar('Dados restaurados com sucesso!'); 
          } catch(err) { notificar('Erro no arquivo'); }
      };
      leitor.readAsText(input.files[0]);
    }

    async function exportarImagem() {
      notificar('Gerando imagem...');
      const canvas = await html2canvas(document.getElementById('areaCaptura'), { scale: 2, backgroundColor: window.getComputedStyle(document.body).backgroundColor });
      const link = document.createElement('a'); 
      link.href=canvas.toDataURL(); 
      link.download='meu_horario.png'; 
      link.click();
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf; 
      const doc = new jsPDF('l','pt','a4');
      doc.text('Meu Planejamento', 40, 40);
      doc.autoTable({ html: '#tabelaPrincipal', startY: 60, theme:'grid' }); 
      doc.save('horario_plan.pdf');
    }
  </script>
</body>
</html>




